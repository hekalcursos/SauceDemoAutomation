name: Playwright Tests  # The name you see in the "Actions" tab on GitHub

on:
  push:
    branches: [ main, master ] # Trigger: Run automatically when you push to main or master
  pull_request:
    branches: [ main, master ] # Trigger: Run when someone opens a Pull Request

permissions:
  contents: write # Keycard: Gives the robot permission to upload the website report

jobs:
  test:
    timeout-minutes: 60 # Safety: Kill the process if it freezes for 1 hour
    runs-on: ubuntu-latest # Environment: Request a fresh Linux computer from GitHub

    steps:
    - uses: actions/checkout@v4 # Step 1: Download your code onto that Linux computer
    - uses: actions/setup-node@v4 # Step 2: Install Node.js (engine needed for Playwright)
      with:
        node-version: lts/*

    - name: Install dependencies
      run: npm ci # Step 3: specific clean install of your libraries (faster than npm install)

    - name: Install Playwright Browsers
      run: npx playwright install --with-deps # Step 4: Download Chrome/Firefox browsers

    - name: Run Playwright tests
      run: npx playwright test # Step 5: The Main Event - Run the actual tests

    - uses: actions/upload-artifact@v4 # Step 6: Save the report folder as a Zip file
      if: always() # Important: Run this even if tests FAIL (so we see the errors)
      with:
        name: playwright-report
        path: playwright-report/
        retention-days: 30 # Delete the zip file after 30 days to save space

    - name: Deploy Report to GitHub Pages # Step 7: Publish the report to the website link
      if: always() # Important: Update the website even if tests fail
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }} # The password the robot uses to log in
        publish_dir: ./playwright-report # The folder to put on the internet
        keep_files: true